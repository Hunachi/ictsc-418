# 接続が不安定になっちゃった！
解いた人:[nonnonno](https://github.com/nonnonno)

参照した問題・解説のサイト:[接続が不安定になっちゃった！](https://blog.icttoracon.net/2019/08/31/ictsc2019-%e4%b8%80%e6%ac%a1%e4%ba%88%e9%81%b8%e3%80%80%e5%95%8f%e9%a1%8c%e8%a7%a3%e8%aa%ac%ef%bc%9a%e6%8e%a5%e7%b6%9a%e3%81%8c%e4%b8%8d%e5%ae%89%e5%ae%9a%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a1%e3%82%83/)

## 使用環境・ツール
何台かのサーバ 

## 問題文でされた操作・バグの内容
通常用セグメント 192.168.1.0/24 と、管理用セグメント 192.168.2.0/24 を持ったネットワーク上にいくつかのサーバがある。client1をこのネットワークに追加し設定したところ、client1とclient2間の通信が不安定になってしまった(通常用セグメントを使うとclient1とclient2の接続が不安定になるということっぽい)。 管理用セグメント (192.168.2.0/24) からは正常にアクセスできるため、こちらからsshすること。

## 理想の終了状態
192.168.1.0/24 のセグメントで正常に通信が行えるようにし、今後同じ状況にならないように設定を書き換えて、原因を報告してほしい。

## 考えられる原因とその検証・修正手順

## 解説
本問題は、動的割当のホストと静的割当のホストのIPアドレスが重複してしまい、通信が不安定になるトラブル。  
この問題はVyOSの設定のservice dhcp-server global-parameters ‘ping-check false;’という項目でDHCPによるアドレス割り当ての前にアドレスの使用状況を確認する動作が無効化されていたため、静的割り当てのホストと同じアドレスがDHCPによって払い出されていた。


### 解答例

[VyOS設定コマンド参考リンク](https://server-network-note.net/2018/01/vyos-basic-config/)  
[VyOSとclientの関係参考リンク(こちらにもコマンド説明あり)](https://www.isoroot.jp/blog/2859/)
ルータに対して以下の操作を行う。  

```
configure
```

で設定モードに入る。  

```
delete service dhcp-server global-parameters ‘ping-check false;’

```

として、 ```commit``` と ```save``` をして完了。  
次に、クライアント端末に対して動的割り当ての設定を行う。  

```
sudo dhclient -r

sudo dhclient
```

dhclientコマンドは、DHCPプロトコルを利用し、NICにIPアドレスを設定したり、借り受けたIPアドレスの解放や、デフォルトルーターやネームサーバーの情報を確認する目的にも利用される。  
今回は、rオプションを使うことで現在借り受けているIPアドレスを開放し、再度DHCPクライアントとして起動してアドレスの付与を受ける。  

## 採点基準

- 正常に通信を行えるかどうか
- 原因を特定し、今後同じ状況にならないような設定にしているか

クライアントのどちらか片方のアドレスをnetplanで静的に書き換えても正常に通信はできますが、問題文に今後同じ状況にならないように設定してください。と記載されているため、DHCPの設定まで直して満点。
